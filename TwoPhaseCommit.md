## 内容概要

- 容错性简述
- 安全性和鲜活度
- 两阶段提交

## 容错性简述

#### 容错性是什么？
- 构建一个支持容错性的系统非常困难。
- 构建容错性系统的三个基本步骤
1. **检测错误。** 通过在数值或者信号量中检测到错误。


## 两阶段提交
#### 两个角色
- 事务协调者
是分布式事务的管理中心，事务的整理流程推进以及决策都依赖于该模块。只有一个事务协调者。

- 事务参与者
分布式事务的参与者，分别为不同节点的服务。每个事务参与者是一个单机事务，所有的事务参与者共同在事务协调者的统一协调之下，共同组成一个全局的分布式事务。

#### 基本流程
顾名思义，两阶段提交就是将提交过程一分为二，将原来单机事务中的一个 commit 步骤拆分为两个步骤。
1. 事务准备
   事务协调者询问各事务参与者是否可以提交事务，各事务参与者应答。分为两个子步骤：

   （1）prepare
   询问事务参与者是否可以完成本次事务。

   （2）"Yes" or "No"
   事务参与者检查相关的限制因素，确认是否满足事务所需条件，并答复事务协调者。Yes - 事务可以提交；No - 事务无法提交。

2. 事务决策与提交
   事务决策者向事务参与者发送决策结果，事务参与者根据执行最终的结果，恢复ACK。也分为两个子步骤。

   （1）decision
   事务决策者将汇总的决策结果发送给各个事务参与者；

   （2）Ack
   事务参与者确认事务，并答复Ack。

#### 故障处理
分布式事务的执行过程中，可能存在以下两种故障。
- 网络故障
- 服务器故障

  我们假设发生上述两种故障都只是暂时的，系统经过监控平台或者认为干预，两种故障最终都会解决。两阶段提交所需要满足的容错性就是在临时出现上述两种故障时，系统如何处理，以确保事务可以正常流转。

